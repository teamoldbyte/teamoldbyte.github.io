(function(a,b){var c=Math.max,d=function(a){this.options=Object.assign({},d.defaults,a),this.isDomNode(this.options.parent)||(this.options.parent=d.defaults.parent),1<this.options.opacity&&100>=this.options.opacity?this.options.opacity/=100:1<this.options.opacity&&255>=this.options.opacity?this.options.opacity/=255:(0>this.options.opacity||1<this.options.opacity&&255<this.options.opacity)&&(this.options.opacity=d.defaults.opacity),0>this.options.fadeDuration?this.options.fadeDuration=d.defaults.fadeDuration:10>this.options.fadeDuration&&(this.options.fadeDuration*=1e3),this.options.padding=parseFloat(this.options.padding)||0===parseFloat(this.options.padding)?parseFloat(this.options.padding):d.defaults.padding,this.options.borderRadius=parseFloat(this.options.borderRadius)||0===parseFloat(this.options.borderRadius)?c(parseFloat(this.options.borderRadius),0):d.defaults.borderRadius,0>this.options.transitionDuration?this.options.transitionDuration=d.defaults.transitionDuration:10>this.options.transitionDuration&&(this.options.transitionDuration*=1e3),0>this.options.resizeDebounce?this.options.resizeDebounce=d.defaults.resizeDebounce:10>this.options.resizeDebounce&&(this.options.resizeDebounce*=1e3),this.options.resizeDebounce=c(this.options.resizeDebounce,100),this.options.zIndex=parseInt(this.options.zIndex)||d.defaults.zIndex,this.options.easing=["none","linear","swing","default"].indexOf(this.options.easing.trim().toLowerCase())?this.options.easing.trim().toLowerCase():d.defaults.easing,this.init()};d.defaults={parent:b.body,opacity:.5,fadeDuration:1e3,padding:5,borderRadius:5,transitionDuration:1e3,resizeDebounce:100,zIndex:99,easing:"swing"},function(){var d=Math.min;this.init=function(){this.els=[],this.rects=[],this.parent=this.options.parent,this.parentRect=this.parent.getBoundingClientRect(),this.canvas=b.createElement("canvas"),this.canvas.width=c(this.parent.clientWidth,this.parent.scrollWidth),this.canvas.height=c(this.parent.clientHeight,this.parent.scrollHeight),this.ctx=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.canvas.style.zIndex=this.options.zIndex,this.canvas.style.pointerEvents="none",this.canvas.style.opacity="0",a.addEventListener("resize",function(){clearTimeout(this.resizeHandle),this.resizeHandle=setTimeout(this.resize.bind(this),this.options.resizeDebounce)}.bind(this)),this.options.parent.appendChild(this.canvas),this.anims=[],this.isVisible=!1,this.resizeHandle=null,this.draw()},this.cleanup=function(){this.clear(),this.rects=[],this.els=[]},this.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},this.roundedRect=function(a,b,c,d,e,f,g){if(e||0===e||(e=this.options.borderRadius),"number"==typeof e)e={tl:e,tr:e,br:e,bl:e};else{var h={tl:this.options.borderRadius,tr:this.options.borderRadius,br:this.options.borderRadius,bl:this.options.borderRadius};for(var i in h)e[i]=e[i]||h[i]}void 0===f&&(f=!0),this.ctx.beginPath(),this.ctx.moveTo(a+e.tl,b),this.ctx.lineTo(a+c-e.tr,b),this.ctx.quadraticCurveTo(a+c,b,a+c,b+e.tr),this.ctx.lineTo(a+c,b+d-e.br),this.ctx.quadraticCurveTo(a+c,b+d,a+c-e.br,b+d),this.ctx.lineTo(a+e.bl,b+d),this.ctx.quadraticCurveTo(a,b+d,a,b+d-e.bl),this.ctx.lineTo(a,b+e.tl),this.ctx.quadraticCurveTo(a,b,a+e.tl,b),this.ctx.closePath(),f&&this.ctx.fill(),g&&this.ctx.stroke()},this.isPercent=function(a){return /^\s*\-?(\d+\.?\d*|\d*\.\d+)%\s*$/.test(a)},this.calcPercent=function(a){return{x:this.isPercent(a.x)?this.canvas.width*parseFloat(a.x)/100:parseFloat(a.x),y:this.isPercent(a.y)?this.canvas.height*parseFloat(a.y)/100:parseFloat(a.y),width:this.isPercent(a.width)?this.canvas.width*parseFloat(a.width)/100:parseFloat(a.width),height:this.isPercent(a.height)?this.canvas.height*parseFloat(a.height)/100:parseFloat(a.height)}},this.draw=function(){this.clear(),this.ctx.globalAlpha=this.options.opacity,this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="destination-out",this.rects.forEach(a=>{var b=Math.abs;let e=this.calcPercent(a),f=c(e.x-this.options.padding,0),g=c(e.y-this.options.padding,0),i=d(e.width+2*this.options.padding-(0>e.x?b(e.x):0),this.canvas.width-f),j=d(e.height+2*this.options.padding-(0>e.y?b(e.y):0),this.canvas.height-g);this.roundedRect(f,g,i,j)}),this.ctx.globalCompositeOperation="source-over"},this.ease=function(a,b){switch(b){case"none":case"linear":return a;case"swing":case"default":default:return .5-Math.cos(a*Math.PI)/2;}},this.fadeOut=function(a){if(this.isFadingOut()||!this.isVisible)return;let b=parseFloat(this.canvas.style.opacity)||1;"function"==typeof a?a={duration:this.options.fadeDuration,onComplete:a}:"number"==typeof a?a={duration:a}:"object"!=typeof a&&(a={duration:this.options.fadeDuration});let c={type:"fadeOut",start:0,stop:!1};this.anims.push(c);let e=function(f){c.start||(c.start=f);let g=0==a.duration?1:this.ease(d((f-c.start)/a.duration,1));this.canvas.style.opacity=(1-g)*b,0<this.canvas.style.opacity&&!c.stop?requestAnimationFrame(e):(!c.stop&&(this.isVisible=!1),this.removeAnim(c.start,c.type),a.onComplete&&"function"==typeof a.onComplete&&a.onComplete())}.bind(this);this.stopFadeIn(),requestAnimationFrame(e)},this.fadeIn=function(b){let c=this.isVisible?parseFloat(this.canvas.style.opacity)||1:0;if(this.isFadingIn()||.99<=c)return!1;"function"==typeof b?b={duration:this.options.fadeDuration,onComplete:b}:"number"==typeof b?b={duration:b}:"object"!=typeof b&&(b={duration:this.options.fadeDuration}),(!b.duration&&0!==b.duration||0>b.duration)&&(b.duration=this.options.fadeDuration),10>b.duration&&(b.duration*=1e3);let e={type:"fadeIn",start:0,stop:!1,startY:a.scrollY+a.innerHeight/2,targetY:this.getAverageY()};this.anims.push(e),this.isVisible=!0;let f=function(g){e.start||(e.start=g);let h=0==b.duration?1:this.ease(d((g-e.start)/b.duration,1));this.canvas.style.opacity=c+h*(1-c),a.scrollTo(0,this.lerp(e.startY-a.innerHeight/2,e.targetY-a.innerHeight/2,h)),1>this.canvas.style.opacity&&!e.stop?requestAnimationFrame(f):(this.removeAnim(e.start,e.type),b.onComplete&&"function"==typeof b.onComplete&&b.onComplete())}.bind(this);this.stopFadeOut(),requestAnimationFrame(f)},this.stop=function(a,b){this.anims.filter(c=>(!(a||0===a)||c.start==a)&&(!b||c.type==b)).forEach(a=>a.stop=!0)},this.stopFadeOut=function(a){this.stop(a,"fadeOut")},this.stopFadeIn=function(a){this.stop(a,"fadeIn")},this.stopTransition=function(a){this.stop(a,"transition")},this.removeAnim=function(a,b){for(let c=this.anims.findIndex(c=>(!(a||0===a)||c.start==a)&&(!b||c.type==b));0<=c;)this.anims.splice(c,1),c=this.anims.findIndex(c=>(!(a||0===a)||c.start==a)&&(!b||c.type==b))},this.isFadingOut=function(){return 0<=this.anims.findIndex(a=>"fadeOut"==a.type&&!a.stop)},this.isFadingIn=function(){return 0<=this.anims.findIndex(a=>"fadeIn"==a.type&&!a.stop)},this.isTransitioning=function(){return 0<=this.anims.findIndex(a=>"transition"==a.type&&!a.stop)},this.resize=function(){!this.isVisible&&this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas),this.canvas.width=c(this.parent.clientWidth,this.parent.scrollWidth),this.canvas.height=c(this.parent.clientHeight,this.parent.scrollHeight),this.isVisible?this.transition():!this.canvas.parentElement&&this.options.parent.appendChild(this.canvas)},this.isDomNode=function(a){try{if(a instanceof HTMLElement||a instanceof SVGElement)return!0}catch(a){}return a&&"object"==typeof a&&1==a.nodeType},this.isDomNodeList=function(a){try{if(a instanceof NodeList)return!0}catch(a){}return a&&"object"==typeof a&&"NodeList"==a.constructor.name},this.isJqueryObject=function(a){if("undefined"==typeof jQuery)return!1;try{if(a instanceof jQuery)return!0}catch(a){}return a&&"object"==typeof a&&a.jquery},this.isWithinDoc=function(a){let b=this.calcPercent(a);return!(0>=b.width||0>=b.height||0>b.x+b.width||b.x>this.canvas.width||0>b.y+b.height||b.y>this.canvas.height)},this.getRect=function(a){let b;return b=this.isDomNode(a)?a.getBoundingClientRect():void 0!==a.width&&void 0!==a.height&&a,b&&void 0!==b.top&&(b.x-=this.parentRect.x,b.y+=-this.parentRect.y+this.parent.scrollTop),b},this.getAverageY=function(){let b=0,c=0;return this.els.forEach(d=>{let e=this.calcPercent(this.getRect(d)),f=e.width*e.height;b+=(e.y+e.height/2)*f,c+=f}),b/c},this.lerp=function(c,a,b){return c+b*(a-c)},this.highlight=function(a,c){this.parentRect=this.parent.getBoundingClientRect(),a||(a=[]),Array.isArray(a)||(a=[a]);for(let d=a.length-1;0<=d;)this.isDomNodeList(a[d])||this.isJqueryObject(a[d])?a=a.slice(0,d).concat(Array.from(a[d])).concat(a.slice(d+1)):"string"==typeof a[d]?a=a.slice(0,d).concat(Array.from(b.querySelectorAll(a[d]))).concat(a.slice(d+1)):!this.isDomNode(a[d])&&(!a[d]||0<!a[d].width||0<!a[d].height)&&a.splice(d,1),d--;let d={add:!1,duration:this.options.transitionDuration,easing:this.options.easing};"boolean"==typeof c?c={add:c}:"number"==typeof c?c={duration:c}:"function"==typeof c?c={onComplete:c}:"object"!=typeof c&&(c={}),c=Object.assign(d,c),a=a.filter(a=>{let b=this.getRect(a);return this.isWithinDoc(b)}),this.els=c.add?this.els.concat(a):a;this.isVisible?(this.isFadingOut()&&this.fadeIn(),this.transition({duration:c.duration,onComplete:c.onComplete,easing:c.easing})):(this.resize(),this.transition({duration:0,onComplete:function(){this.fadeIn({onComplete:c.onComplete})},easing:c.easing}))},this.rehighlight=function(a){"boolean"==typeof a?a={add:a}:"number"==typeof a?a={duration:a}:"function"==typeof a?a={onComplete:a}:"object"!=typeof a&&(a={}),a.add=!0,this.highlight(!1,a)},this.transition=function(b){let c={duration:this.options.transitionDuration,easing:this.options.easing};for("number"==typeof b?b={duration:b}:"boolean"==typeof b?b={follow:b}:"function"==typeof b?b={onComplete:b}:"object"!=typeof b&&(b={}),b=Object.assign(c,b),(!b.duration&&0!==b.duration||0>b.duration)&&(b.duration=this.options.transitionDuration),10>b.duration&&(b.duration*=1e3),("none"==b.easing||"linear"==b.easing)&&(b.easing=!1),this.stopTransition();this.rects.length<this.els.length;)this.rects.push({x:this.canvas.width/2-this.options.padding,y:2*-this.options.padding,width:-2*this.options.padding,height:-2*this.options.padding});let e=[];this.parentRect=this.parent.getBoundingClientRect(),this.rects.forEach((a,b)=>{let c=this.els.length>b?this.calcPercent(this.getRect(this.els[b])):{x:this.canvas.width/2-this.options.padding,y:2*-this.options.padding,width:-2*this.options.padding,height:-2*this.options.padding};e.push(c)});let f=[];this.rects.forEach((a,b)=>{e.forEach((c,d)=>{var e=Math.pow;let g=e(a.x-c.x,2)+e(a.y-c.y,2);f.push({from:b,to:d,dist:g})})}),f.sort((c,a)=>c.dist-a.dist);let g=[],h=[],i=[];this.rects.forEach(()=>{g.push(!1),h.push(!1),i.push(-1)}),f.forEach(a=>{g[a.from]||h[a.to]||(g[a.from]=h[a.to]=!0,i[a.from]=a.to)});let j=[];i.forEach(a=>{j.push(e[a])});let k={type:"transition",start:0,stop:!1,startRects:this.rects.slice(0),targetRects:j,startY:a.scrollY+a.innerHeight/2,targetY:this.getAverageY()};this.anims.push(k);var l=function(c){k.start||(k.start=c);let e=0==b.duration?1:d((c-k.start)/b.duration,1);b.easing&&(e=this.ease(e)),k.stop||(this.rects.forEach((a,b,c)=>{let d=k.targetRects[b];c[b].x=this.lerp(k.startRects[b].x,d.x,e),c[b].y=this.lerp(k.startRects[b].y,d.y,e),c[b].width=this.lerp(k.startRects[b].width,d.width,e),c[b].height=this.lerp(k.startRects[b].height,d.height,e)}),0<b.duration&&a.scrollTo(0,this.lerp(k.startY-a.innerHeight/2,k.targetY-a.innerHeight/2,e)),this.draw(),1>e&&requestAnimationFrame(l)),(k.stop||1<=e)&&(!k.stop&&(this.rects=this.rects.filter(this.isWithinDoc.bind(this)),this.draw()),this.removeAnim(k.start,k.type),b.onComplete&&"function"==typeof b.onComplete&&b.onComplete())}.bind(this);requestAnimationFrame(l)}}.call(d.prototype),a.Dimmer=d})(this,this.document);